<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ '/styles.css' | relative_url }}?v={{ site.time | date: '%s' }}">
</head>
<body>
  <nav id="toc" class="toc">
    <div class="toc-title">Contents</div>
    <ul></ul>
  </nav>

  <main>
    <a href="{{ '/' | relative_url }}" class="back-link">Back to writings</a>
    <article>
      <h1>{{ page.title }}</h1>
      <div class="article-date">{{ page.date | date: "%B %-d, %Y" }}</div>
      <div class="article-content">
        {{ content }}
      </div>
    </article>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const content = document.querySelector('.article-content');
      const toc = document.querySelector('#toc ul');
      const headings = content.querySelectorAll('h1, h2, h3');

      if (headings.length === 0) {
        document.getElementById('toc').style.display = 'none';
        return;
      }

      const headingsList = [];

      headings.forEach((heading, index) => {
        const id = heading.id || 'heading-' + index;
        heading.id = id;
        headingsList.push({ id, element: heading });

        const li = document.createElement('li');
        li.className = 'toc-' + heading.tagName.toLowerCase();

        const a = document.createElement('a');
        a.href = '#' + id;
        a.textContent = heading.textContent;

        li.appendChild(a);
        toc.appendChild(li);
      });

      function updateActiveHeading() {
        const scrollPos = window.scrollY + 100;
        let currentId = headingsList[0]?.id;

        for (const { id, element } of headingsList) {
          if (element.offsetTop <= scrollPos) {
            currentId = id;
          }
        }

        document.querySelectorAll('#toc a').forEach(a => {
          a.classList.toggle('active', a.getAttribute('href') === '#' + currentId);
        });
      }

      window.addEventListener('scroll', updateActiveHeading);
      updateActiveHeading();
    });
  </script>
</body>
</html>
